#!/bin/bash

# Seed phrase ile keypair kurtar
solana-keygen recover "prompt://?key=0/0" -o recovered.json --force

# Pubkey'i al
PUBKEY=$(solana-keygen pubkey recovered.json)

echo "ðŸ“Œ CÃ¼zdanÄ±nÄ±zÄ±n Devnet Pubkey'i: $PUBKEY"

# Bakiyeyi gÃ¶ster
solana balance --keypair recovered.json --url https://api.devnet.solana.com

# Airdrop gÃ¶nder
echo "ðŸ’§ 5 SOL airdrop isteniyor..."
solana airdrop 5 $PUBKEY --url https://api.devnet.solana.com

# Anchor build
anchor build

# Anchor deploy
DEPLOY_OUTPUT=$(anchor deploy --provider.cluster devnet)

# Program ID'yi parse et ve .env dosyasÄ±na yaz
PROGRAM_ID=$(echo "$DEPLOY_OUTPUT" | grep "Program Id:" | awk '{print $3}')
echo "PROGRAM_ID=$PROGRAM_ID" > .env
echo "ðŸ“Œ Program ID: $PROGRAM_ID .env dosyasÄ±na kaydedildi."

# Test Ã¶ncesi bakiye bildirimi
solana balance $PUBKEY

# Proje test
ts-node tests/blokaid.ts
